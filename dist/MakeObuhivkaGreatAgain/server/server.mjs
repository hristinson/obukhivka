import { createRequire } from 'node:module';
globalThis['require'] ??= createRequire(import.meta.url);
import{a as g,d as A}from"./chunk-ALW5VTGR.mjs";import L from"./angular-app-engine-manifest.mjs";var l;function R(r){l=r}function C(){if(!l)throw new Error("Angular app engine manifest is not set. Please ensure you are using the '@angular/build:application' builder to build your server application.");return l}function y(r){return r[0]==="/"?r:`/${r}`}function E(...r){let o=[];for(let e of r){if(e==="")continue;let t=e;e[0]==="/"&&(t=t.slice(1)),e[e.length-1]==="/"&&(t=t.slice(0,-1)),t!==""&&o.push(t)}return y(o.join("/"))}var u=(function(r){return r[r.Server=0]="Server",r[r.Client=1]="Client",r[r.Prerender=2]="Prerender",r})(u||{});var H=new RegExp("(?<!\\\\):([^/]+)","g");var d=class{store=new Map;async run(o,e){let t=this.store.get(o);switch(o){case"html:transform:pre":{if(!t)return e.html;let n=g({},e);for(let s of t)n.html=await s(n);return n.html}default:throw new Error(`Running hook "${o}" is not supported.`)}}on(o,e){let t=this.store.get(o);t?t.push(e):this.store.set(o,[e])}has(o){return!!this.store.get(o)?.length}};var $={[u.Prerender]:"ssg",[u.Server]:"ssr",[u.Client]:""};function T(r,o){let{pathname:e}=r,t=o.length;e[t]==="/"&&t++;let n=e.indexOf("/",t);return n===-1&&(n=e.length),e.slice(t,n)}function N(r){if(r==="*")return new Map([["*",1]]);let o=r.split(",").map(e=>{let[t,n]=e.split(";",2).map(i=>i.trim()),s=n?.startsWith("q=")?parseFloat(n.slice(2)):void 0;return(typeof s!="number"||isNaN(s)||s<0||s>1)&&(s=1),[t,s]}).sort(([e,t],[n,s])=>s-t);return new Map(o)}function x(r,o){if(o.length<2)return o[0];let e=N(r);if(e.size===0||e.size===1&&e.has("*"))return o[0];let t=new Map;for(let i of o)t.set(m(i),i);let n,s=new Set;for(let[i,a]of e){let c=m(i);if(a===0){s.add(c);continue}if(t.has(c))return t.get(c);if(n!==void 0)continue;let[S]=c.split("-",1);for(let p of t.keys())if(p.startsWith(S)){n=t.get(p);break}}if(n!==void 0)return n;for(let[i,a]of t)if(!s.has(i))return a}function m(r){return r.toLowerCase()}var f=(()=>{class r{static \u0275allowStaticRouteRender=!1;static \u0275hooks=new d;manifest=C();supportedLocales=Object.keys(this.manifest.supportedLocales);entryPointsCache=new Map;async handle(e,t){let n=await this.getAngularServerAppForRequest(e);return n?n.handle(e,t):this.supportedLocales.length>1?this.redirectBasedOnAcceptLanguage(e):null}redirectBasedOnAcceptLanguage(e){let{basePath:t,supportedLocales:n}=this.manifest,{pathname:s}=new URL(e.url);if(s!==t)return null;let i=x(e.headers.get("Accept-Language")||"*",this.supportedLocales);if(i){let a=n[i];if(a!==void 0)return new Response(null,{status:302,headers:{Location:E(s,a),Vary:"Accept-Language"}})}return null}async getAngularServerAppForRequest(e){let t=new URL(e.url),n=await this.getEntryPointExportsForUrl(t);if(!n)return null;let s=n.\u0275getOrCreateAngularServerApp;return s({allowStaticRouteRender:r.\u0275allowStaticRouteRender,hooks:r.\u0275hooks})}getEntryPointExports(e){let t=this.entryPointsCache.get(e);if(t)return t;let{entryPoints:n}=this.manifest,s=n[e];if(!s)return;let i=s();return this.entryPointsCache.set(e,i),i}getEntryPointExportsForUrl(e){let{basePath:t}=this.manifest;if(this.supportedLocales.length===1)return this.getEntryPointExports("");let n=T(e,t);return this.getEntryPointExports(n)??this.getEntryPointExports("")}}return r})();function v(r){return r.__ng_request_handler__=!0,r}R(L);var h={};A(h,{netlifyAppEngineHandler:()=>P,reqHandler:()=>_});var w=()=>typeof Netlify<"u"?Netlify?.context:void 0;var b=new f;async function P(r){let o=w();return await b.handle(r,o)||new Response("Not found",{status:404})}var _=v(P);var I="default",z=h[I];export{f as AngularAppEngine,z as default,P as netlifyAppEngineHandler,_ as reqHandler};
